<!DOCTYPE html>
<html>

<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
	<link rel="stylesheet" href="stylesheets/homeStyle.css">
	<link href="https://fonts.googleapis.com/css?family=PT+Sans" rel="stylesheet">
</head>

<body>
<!-- Scripts for This Page -->

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/seedrandom/2.4.2/seedrandom.js"></script>
	<script src="scripts/note.js"></script>
	<script src="scripts/folder.js"></script>
	<script type="text/javascript">

	var appendToPath = "file:///C:/Users/Sitara/LIT/";
	var folderCount = 0;
	var fileCount = 0;

	var currentFolder = new Folder('home', 'Owner', folderCount); // TODO: CHANGE THIS TO A PRE-POPULATED DIRECTORY FOR USER TESTING
	var folderChain = [currentFolder];
	folderCount += 1;

	function changeURL(newUrl){
		console.log(appendToPath +newUrl);
		document.location.href = appendToPath +newUrl;
	}

	// Allow files and folders to be dropped into other folders
	function allowDrop(e){
		e.preventDefault();
	}

	function drag(e){
		e.preventDefault();
		console.log($(e.target).parent());
	}

	function drop(e){
		console.log(e.dataTransfer);
		console.log(e.dataTransfer.getData("Text"));
		alert('Added to ' + e.target.id+ ' !');
	}

	function saveFolderName(folderID){
		var changeFolder = folderChain[folderChain.length-1].getFolder(folderID);
		var newName = document.getElementById("folderName_"+folderID).value;
		changeFolder.updateName(newName);
	}

	function saveFileName(fileID){
		var changeFile = folderChain[folderChain.length-1].getFile(fileID);
		console.log(changeFile);
		var newName = document.getElementById("fileName_"+fileID).value;
		changeFile.updateName(newName);
	}

	function openFolder(newFolderID){
		// Clear the current folders from the page 
		$('#folderContainer').empty();
		$('#fileContainer').empty();
		$('#templateContainer').empty();
		// change currentFolder to the new folder
		subFolder = folderChain[folderChain.length-1].getFolder(newFolderID);
		folderChain.push(subFolder);
		// Load the subfolders and subfiles
		console.log('Opening '+folderChain[folderChain.length-1].ID);
	}

	function openFile(newFileID){	
		// Open the URL for the file editor, need to find a way to pass data about the ID
		localStorage.setItem('DIRECTORY',JSON.stringify(folderChain[0]));
		changeURL('editor.html');
	}

	function createFolder(){
		newFolder = new Folder('Untitled', 'Owner', folderCount);
		console.log(folderChain[folderChain.length-1]);
		console.log('Adding folder '+newFolder.ID +' to '+folderChain[folderChain.length-1].ID);
		folderChain[folderChain.length-1].addFolder(newFolder);
		folderCount += 1;
		drawFolder(newFolder);
	}

	function createFile(){
		newFile = new Note('Untitled', 'Owner', fileCount);
		console.log('Creating file in '+folderChain[folderChain.length-1].ID);
		folderChain[folderChain.length-1].addFile(newFile);
		fileCount += 1;
		drawFile(newFile);
	}

	function modifyFileOptions(){

	}
	// <!-- Event Handlers -->
	function drawFolder(folderToAdd){
		console.log('Adding folder to view');
		$('#emptyFolder').remove();
		var div = document.createElement("div");
		div.setAttribute("class", "col-md-4 col-sm-4 col-lg-4 col-xs-4 col-xl-4 control-label center-block text-center");
		div.setAttribute("draggable", "true");
		div.setAttribute("ondrop","drop(event)");
		div.setAttribute("ondragover", "allowDrop(event)");
		div.setAttribute("ondblclick", "openFolder('"+folderToAdd.ID+"')");
		div.id = "folder_"+folderToAdd.ID;

		div.style.width = "150px";
		div.style.height = "150px";
		div.style.background = "white";
		div.style.margin = "25px";
		div.style.padding = "0px";


		var table = document.createElement("table");
		var img_row = table.insertRow(0);
		var img_cell = img_row.insertCell(0);
		img_cell.style.height = "125px";
		img_cell.style.width = "150px";
		img_cell.style.backgroundColor = "#c4c4d6";
		img_cell.style.padding = "0px";
		img_cell.innerHTML = "<img src='images/folder.png' style='width:100px; height:100px; cursor:move;'>";


		var details_row = table.insertRow(1);
		var input_cell = details_row.insertCell(0);

		var input_name = document.createElement("input");
		input_name.setAttribute('class', 'text-center');
		input_name.setAttribute('type', 'text');
		input_name.setAttribute('placeholder', 'Untitled');
		input_name.setAttribute('onKeyUp', "saveFolderName('"+folderToAdd.ID+"')");
		input_name.id = "folderName_"+folderToAdd.ID;
		input_cell.appendChild(input_name);

		div.appendChild(table);

		var options = document.createElement("div");
		options.setAttribute('onclick', "modifyFileOptions('"+folderToAdd+"')");
		options.innerHTML = "<span class='glyphicon glyphicon-option-vertical' style='right:0; padding-top:5px;'></span>";
		options.setAttribute("class", "options");

		div.appendChild(options);
			// "<div class='container filename text-center'> <div class='row'><div class='col-lg-8'><input type='text' name='name' placeholder='Untitled' value='Untitled'></div> <div class='col-lg-1'>A</div> <div class='col-lg-1'> B </div> </div> </div>";

		document.getElementById("folderContainer").appendChild(div);
	};

	function drawFile(fileToAdd){
		$('#emptyFile').remove();
		var div = document.createElement("div");
		div.setAttribute("class", "col-md-4 col-sm-4 col-lg-4 col-xs-4 col-xl-4 control-label center-block text-center");
		div.setAttribute("draggable","true");
		div.id = "file_"+fileToAdd.ID;
		div.setAttribute("ondblclick", "openFile('"+fileToAdd.ID+"')");
		div.style.width = "150px";
		div.style.height = "175px";
		div.style.background = "white";
		div.style.margin = "25px";
		div.style.padding = "0px";


		var table = document.createElement("table");
		var img_row = table.insertRow(0);
		var img_cell = img_row.insertCell(0);
		img_cell.style.height = "150px";
		img_cell.style.width = "150px";
		img_cell.style.backgroundColor = "#c4c4d6";
		img_cell.style.padding = "0px";
		img_cell.innerHTML = "<img src='images/file.png' style='width:120px; height:120px; cursor:move;'>";


		var details_row = table.insertRow(1);
		var input_cell = details_row.insertCell(0);

		var input_name = document.createElement("input");
		input_name.setAttribute('class', 'text-center');
		input_name.setAttribute('type', 'text');
		input_name.setAttribute('placeholder', 'Untitled');
		input_name.setAttribute('onKeyUp', "saveFileName('"+fileToAdd.ID+"')");
		input_name.id = "fileName_"+fileToAdd.ID;
		input_cell.appendChild(input_name);

		div.appendChild(table);


		// div.innerHTML = "<table><tr><td style='height:150px; width:150px; background-color:#c4c4d6; padding:0px;'> <img src='images/file.png' style='width:125px; height:125px; cursor:move;'> </td></tr> <tr><td style='background-color:red;'><input type='text' name='name' class='text-center' placeholder='Untitled' value='Untitled'></td> </tr></table>"

		var options = document.createElement("div");
		options.setAttribute('onclick', "modifyFileOptions('"+fileToAdd+"')");
		options.innerHTML = "<span class='glyphicon glyphicon-option-vertical' style='right:0; padding-top:5px;'></span>";
		options.setAttribute("class", "options");

		div.appendChild(options);
			// "<div class='container filename text-center'> <div class='row'><div class='col-lg-8'><input type='text' name='name' placeholder='Untitled' value='Untitled'></div> <div class='col-lg-1'>A</div> <div class='col-lg-1'> B </div> </div> </div>";

		document.getElementById("fileContainer").appendChild(div);
	};
		
	</script>

	<div class="container" id="headerContainer">
		<div class="col-md-2 text-center" id="leftColumn">
			<img src="images/LIT-logo.png" alt="LIT" style="width:100px;height:100px;">
		</div>

		<div class="col-md-8" id="searchColumn">
			<div class="row" style="padding-right: 20px;">
			  <input class="form-control input-md search" placeholder= "Search experiments ..." type="text">
			</div>
			<div class="row">
				<nav class="navbar navbar-default">
				  <div class="container-fluid text-center" style="width: 100%; padding-left: 0px; padding-right: 20px;">
					<ul class="nav navbar-nav" style="width: 100%;" >
					  <li style='width:33.3%' class="active" onclick="changeURL('index.html')"><a href="#">My Notebook</a></li>
					  <li style='width:33.3% 'onclick="changeURL('shared.html')"><a href="#">Shared With Me</a></li>
					  <li style='width:33.3%' onclick="changeURL('calendar.html')"><span class="glyphicons glyphicon-family"></span> <a href="#">Calendar</a></li>
					</ul>
				  </div>
				</nav>
			</div>
		</div>

		<div class="col-md-2" style="text-align: right;">
		ACCOUNT
		</div>
	</div>
	<div class="container" id="mainContainer">
		<div class="col-md-2" id="sideNavigation">
			<div class="row nav-option" onclick="createFolder()">
			<span class="glyphicon glyphicon-folder-open" style="padding-right: 15px;"></span> New Folder
			</div>
			<div class="row nav-option" onclick="createFile()">
			<span class="glyphicon glyphicon-file " style="padding-right: 15px;"></span> New Experiment
			</div>
			<div class="row nav-option">
			<span class="glyphicon glyphicon-adjust" style="padding-right: 15px;"></span> New Template
			</div>
			<div class="row nav-option">
			<span class="glyphicon glyphicon-adjust" style="padding-right: 15px;"></span> Share
			</div>
		</div>

		<div class="col-md-10" id="mainBody">
			<div class="container">
				<div class="row">
					<span class="heading"> Folders</span>
				</div>
				<div class="row" id="folderContainer" style="min-height: 100px;">
					<div class="col-md-12" style="line-height: 100px;" id="emptyFolder"> You haven't added any folders yet! :( </div>
				</div>
				<div class="row">
					<span class="heading">Files</span>
				</div>
				<div class="row" id="fileContainer" style="min-height: 100px;">
					<div class="col-md-12" style="line-height: 100px;" id="emptyFile"> You haven't added any files yet! :(
					</div>
				</div>

				<div class="row">
					<span class="heading">Templates</span>

				</div>
				<div class="row" id="templateContainer" style="min-height: 100px;">
					<div id="emptyTemplate" class="col-md-12" style="line-height: 100px;" >
					You haven't created any templates yet! :( </div>
				</div>
			</div>
		</div>
	</div>

	<footer class="text-center">
		<div>Icons made by <a href="http://www.flaticon.com/authors/roundicons" title="Roundicons">Roundicons</a> from <a href="http://www.flaticon.com" title="Flaticon">www.flaticon.com</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0" target="_blank">CC 3.0 BY</a></div>
	</footer>

</body>
</html>
